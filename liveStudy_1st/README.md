# 1주차 : JVM은 무엇이며 자바 코드는 어떻게 실행하는 것인가.

# 목표

## 자바 소스 파일(.java)을 JVM으로 실행하는 과정 이해하기.

---

# 학습할 것

## JVM이란 무엇인가

내가 아는 것 : 
Java Virtual Machine
java에는 두가지가 있다.  컴파일러 & 인터프리터 같은 무언가.

⇒ 인터프리터와 JIT가 있었다.

![1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20JVM%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%86%E1%85%A7%20%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20d846e2f2067443db99e4b0b353c25fa9/Untitled.png](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20JVM%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%86%E1%85%A7%20%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20d846e2f2067443db99e4b0b353c25fa9/Untitled.png)

ref. [https://asfirstalways.tistory.com/158](https://asfirstalways.tistory.com/158)

자바 바이트코드를 실행할 수 있는 주체이다.
java 애플리케이션을 클래스 로더를 통해 읽어 들여 자바 API와 함께 실행.
java와 OS사이에 중개자 역할 → OS에 독립적으로 재사용 가능.
Garbage collection 수행.

### **자바 바이트코드**

- 플랫폼에 독립적.
- 자바 가상 머신 규격에 정의된 대로 실행.
⇒ 표준 자바 API까지 동일한 동작을 하도록 구현한 상태에서는 이론적으로 모든 자바 프로그램은 CPU나 OS에 무관하게 동일한 동작 보장.

### 자바 가상 머신 특성

- 스택 기반의 가상 머신
- 포인터 지원하되, C처럼 주소값 임의 조작은 불가능
- 가비지 컬렉션 사용
- 모든 기본 타입 정의 명확 → 플랫폼 독립성 보장
- 스택넘침, 타입규칙위반, 필드접근규칙위반, 지역변수초기화관련 등 검증 → 실행 시 안전 보장
- 명령어에서 스택에서 가져올 피연산자의 타입을 명령어에 지정( iadd, fadd 와 같은 것)

### 구현 방식

1. 인터프리터
2. JIT 컴파일러
3. jop 자바 프로세서
하드웨어와 소프트웨어 혼합 구현
100% 하드웨어 구현은 비효율적

## 컴파일 하는 방법

컴파일은 javac를 이용하여 .java를 .class로 바꾼다.

```jsx
$ javac ~~~.java
```

## 실행하는 방법

실행은 java를 이용하여 컴파일된 파일을 실행한다.

```jsx
//(1)
$ java ~~~.

//(2)
$ java ~~~/
```

## java 빌드 과정

![1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20JVM%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%86%E1%85%A7%20%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20d846e2f2067443db99e4b0b353c25fa9/Untitled%201.png](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20JVM%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%AE%E1%84%8B%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%86%E1%85%A7%20%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%20%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%84%E1%85%A5%E1%87%82%E1%84%80%E1%85%A6%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%92%E1%85%A2%E1%86%BC%20d846e2f2067443db99e4b0b353c25fa9/Untitled%201.png)

### 자바 프로그램 실행 과정 (1)

1. 프로그램이 실행되면 JVM은 OS로부터 이 프로그램이 필요로 하는 **메모리를 할당** 받는다.
JVM은 이 메모리를 용도에 따라 영역을 나누어 관리한다.
2. **자바 컴파일러(javac)**가 **자바 소스코드(.java)**를 읽어들여 자바 **바이트코드(.class)**로 변환시킨다.
3. **Class Loader를 통해 class파일들을 JVM으로 로딩**한다.
4. 로딩된 class파일들은 **Execution engine을 통해 해석**된다.
5. **해석된 바이트코드는 Runtime Data Areas에 배치**되어 실질적인 수행을 한다.
실행과정에서 **Thread Synchronization / G.C.** 와 같은 관리 작업을 수행한다.

### 자바 프로그램 실행 과정(2)

1. development tool을 이용하여 .java 파일을 생성.
2. Build 시 javac를 이용해 .class 생성.
→ 인간용 바이트코드(반기계어)
3. **class loader**에 의해 JVM내로 load.
4. **Execution engine**을 통해 메모리상에 배치.
→ Interpreter & JIT Compiler
5. **Memory Area
Stack** : 매개변수, 지역변수, 리턴값, LIFO, 실행 후 제거, 임시 저장 공간
**Method**(**class**, **static**) : 클래스, 메소드, 멤버, 상수
**Heap** : New, 인스턴스, 배열, GC의 대상
**PC Register** : 쓰레드마다 하나 씩 생성, JVM 명령의 주소값이 저장.
**Native Method Stack** : 다른 언어 호출 할당

## 바이트코드란 무엇인가

가상머신이 이해할 수 있는 언어로 변환된 자바 소스 코드.

명령어의 크기가 1바이트라서 자바 바이트 코드라고 불림.

.class 확장자를 가짐.

자바 가상 머신만 설치되어 있으면, 어떤 운영체제에서라도 실행.

## JIT 컴파일러란 무엇이며 어떻게 동작하는지

실행중인 런타임에 실제 기계어로 변환해주는 컴파일러를 의미.

동적 번역 ⇒ 인터프리터 중 반복될 것들을 미리 기계어로 바꿔서 빠르게

## JVM 구성 요소

### Class Loader(클래스 로더)

JVM내로 클래스(.class파일) 로드, 링크를 통해 배치하는 작업을 수행하는 모듈.

Runtime시 동적으로 클래스 로드.

jar파일 내 저장된 클래스를 JVM위에 탑재, 사용X 클래스는 메모리에서 삭제.

즉, 클래스를 처음 참조할 때, 로드 및 링크

### Execution Engine(실행 엔진)

클래스를 실행시키는 역할.

JVM내 런타임 데이터 영역에 배치된 바이트 코드를 실행시키는 주체.

기계가 실행할 수 있는 형태로 변환.

### Interpreter(인터프리터)

실행 엔진은 자바 바이트 코드를 명령어 단위로 읽어서 실행.

한 줄씩 수행은 역시 느림.

### JIT(Just - In - Time)

인터프리터 약점 보완.

인터프리터로 실행하다가 → 바이트코드 전체 컴파일 → 네이티브 코드로 변경
네이티브 코드는 캐시에 보관 빠르다.

JIT는 내부적으로 자주 수행 되는 것들만 변경하고, 한 번만 수행하는 것들은 그냥 인터프리터로 실행한다.

### Garbage Collector

GC를 수행하는 모듈(쓰레드) : 사용하지 않는 인스턴스를 해제 해줌.

## JDK와 JRE의 차이

**👍요약 : JDK = JRE + @
JRE는 Read-Only
JDK는 Read/Write**

### JRE (Java Runtime Environment)

컴파일된 자바 프로그램을 실행시킬 수 있는 자바 환경.

JRE는 JVM이 프로그램 동작 하기 위한  library & file & etc..를 가진다.

JRE는 JVM의 실행환경을 구현.

JRE는 반드시 필요.

**환경일 뿐, 프로그래밍을 위해서는 JDK 필요.**

### JDK (Java Development Kit)

JDK는 개발을 위한 도구(javac, java 등)를 포함.

JDK설치 시, JRE도 같이 설치된다. (필요하기 때문)

---

# 마감 일시

## 2020년 11월 21일 오후 10시

---